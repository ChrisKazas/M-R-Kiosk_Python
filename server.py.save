from flask import Flask, render_template
from datetime import date
from pymongo import MongoClient
from bson import ObjectId as ObjectId


# Create app instance
app = Flask(__name__)

# Create a Client Connection to MongoDB
conn = MongoClient(host='localhost', port=27017)

# Create a DB Handle
dbh = conn['KioskDB']

# Return all shops and workorders from DB
#shops = dbh.shopmodels.find({})
mech = dbh.mechmodels.find({})
wos = dbh.workordermodels.find({})


# Home route
@app.route('/')
@app.route('/home')
def home():

	# Get todays date
	d = date.today()
	today = d.strftime("%A %B %d %Y")
	return render_template("home.html", today=today)

# New workorder route
@app.route('/newWrkOrd')
def newWrkOrd():
	shops = dbh.shopmodels.find({})
	mechs = dbh.mechmodels.find({})
	return render_template("newWrkOrd.html", shops=shops, mechs=mechs )

#
@app.route('/editWorkOrder')
def editWorkOrder():

	mechs = dbh.mechmodels.find({})
	shops = dbh.shopmodels.find({})
	openWos = dbh.workordermodels.find({'workDone':{'$exists':False}})

	return render_template("editWorkOrder.html", openWos=openWos, shops=shops, mechs=mechs)

#
@app.route('/shopsAdmin')
def shopsAdmin():
	shops = dbh.shopmodels.find({})
	return render_template('shopsAdmin.html', shops=shops)

#
@app.route('/mechsAdmin')
def mechsAdmin():
	mechs = dbh.mechmodels.find({})
	return render_template('mechsAdmin.html', mechs=mechs)


# Injury Report route
@app.route('/injuryReport')
def injuryReport():
	shops = dbh.shopmodels.find({})
	mechs = dbh.mechmodels.find({})
	return render_template("injury.html", shops=shops, mechs=mechs )





if __name__ == "__main__":
	app.run(debug=True)
